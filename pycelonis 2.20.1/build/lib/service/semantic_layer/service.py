import logging
from datetime import datetime
from io import BytesIO
from typing import Any, Dict, List, Optional, Union

from pydantic.v1 import Field

from pycelonis_core.base.base_model import (PyCelonisBaseEnum,
                                            PyCelonisBaseModel)
from pycelonis_core.client.client import Client
from pycelonis_core.utils.ml_workbench import TRACKING_LOGGER

logger = logging.getLogger(TRACKING_LOGGER)


JsonNode = Any


class CascadeType(PyCelonisBaseEnum):
    DELETE = "DELETE"


class ContentNodeType(PyCelonisBaseEnum):
    ASSET = "ASSET"
    PACKAGE = "PACKAGE"
    FOLDER = "FOLDER"
    IMAGE = "IMAGE"


class RelationType(PyCelonisBaseEnum):
    USES = "USES"
    DEPENDS_ON = "DEPENDS_ON"


class KpiDirection(PyCelonisBaseEnum):
    INCREASE = "INCREASE"
    DECREASE = "DECREASE"
    NEUTRAL = "NEUTRAL"
    NONE = "NONE"


class LayerKind(PyCelonisBaseEnum):
    BASE = "BASE"
    EXTENSION = "EXTENSION"


class MetadataType(PyCelonisBaseEnum):
    KPI = "KPI"
    RECORD = "RECORD"
    VARIABLE = "VARIABLE"
    ACTIVITY = "ACTIVITY"
    FILTER = "FILTER"
    ACTION = "ACTION"
    ANOMALY = "ANOMALY"
    ATTRIBUTE = "ATTRIBUTE"
    NEW_ATTRIBUTE = "NEW_ATTRIBUTE"
    AUGMENTED_ATTRIBUTE = "AUGMENTED_ATTRIBUTE"
    PRIORITY = "PRIORITY"
    FLAG = "FLAG"
    EVENT_LOG = "EVENT_LOG"
    DATA_TRIGGER = "DATA_TRIGGER"


class ParameterType(PyCelonisBaseEnum):
    VARIABLE = "VARIABLE"
    TABLE = "TABLE"
    INTEGER = "INTEGER"
    TEXT = "TEXT"
    PQL = "PQL"


class ScopeType(PyCelonisBaseEnum):
    DISABLED = "DISABLED"


class TransitionType(PyCelonisBaseEnum):
    NON_INTERLEAVED = "NON_INTERLEAVED"
    INTERLEAVED = "INTERLEAVED"


class ComputeCallerType(PyCelonisBaseEnum):
    PROCESS_WORKSPACE = "PROCESS_WORKSPACE"
    KNOWLEDGE_MODEL = "KNOWLEDGE_MODEL"
    VIEW = "VIEW"
    DATA_MODEL = "DATA_MODEL"


class DataPermissionStrategy(PyCelonisBaseEnum):
    AND = "AND"
    OR = "OR"


class ExceptionReference(PyCelonisBaseModel):
    reference: Optional['str'] = Field(alias="reference")
    message: Optional['str'] = Field(alias="message")
    short_message: Optional['str'] = Field(alias="shortMessage")


class FrontendHandledBackendError(PyCelonisBaseModel):
    frontend_error_key: Optional['str'] = Field(alias="frontendErrorKey")
    error_information: Optional['Any'] = Field(alias="errorInformation")


class FinalModelOptions(PyCelonisBaseModel):
    with_variable_replacement: Optional['bool'] = Field(alias="withVariableReplacement")
    with_autogenerated_data_model_data: Optional['bool'] = Field(alias="withAutogeneratedDataModelData")
    with_default_values: Optional['bool'] = Field(alias="withDefaultValues")
    validate_pql: Optional['bool'] = Field(alias="validatePql")
    with_unknown_variables_validation: Optional['bool'] = Field(alias="withUnknownVariablesValidation")
    with_resolved_scopes: Optional['bool'] = Field(alias="withResolvedScopes")


class YamlMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    key: Optional['str'] = Field(alias="key")
    parent_node_id: Optional['str'] = Field(alias="parentNodeId")
    final_model_options: Optional['FinalModelOptions'] = Field(alias="finalModelOptions")
    content: Optional['str'] = Field(alias="content")
    visual_editor_validation: Optional['bool'] = Field(alias="visualEditorValidation")


class AssetMetadataTransport(PyCelonisBaseModel):
    used_variables: Optional['List[Optional[VariableDefinition]]'] = Field(alias="usedVariables")
    related_assets: Optional['List[Optional[RelatedAsset]]'] = Field(alias="relatedAssets")
    asset_usages: Optional['List[Optional[AssetUsage]]'] = Field(alias="assetUsages")
    metadata: Optional['JsonNode'] = Field(alias="metadata")
    hidden: Optional['bool'] = Field(alias="hidden")


class AssetUsage(PyCelonisBaseModel):
    object_id: Optional['str'] = Field(alias="objectId")
    target_objects: Optional['List[Optional[TargetUsageMetadata]]'] = Field(alias="targetObjects")


class ContentNodeBaseTransport(PyCelonisBaseModel):
    reference: Optional['str'] = Field(alias="reference")
    version: Optional['str'] = Field(alias="version")
    external: Optional['bool'] = Field(alias="external")


class ContentNodeTransport(PyCelonisBaseModel):
    permissions: Optional['List[Optional[str]]'] = Field(alias="permissions")
    tenant_id: Optional['str'] = Field(alias="tenantId")
    id: Optional['str'] = Field(alias="id")
    key: Optional['str'] = Field(alias="key")
    name: Optional['str'] = Field(alias="name")
    root_node_key: Optional['str'] = Field(alias="rootNodeKey")
    base: Optional['ContentNodeBaseTransport'] = Field(alias="base")
    asset_type: Optional['str'] = Field(alias="assetType")
    node_type: Optional['ContentNodeType'] = Field(alias="nodeType")
    parent_node_key: Optional['str'] = Field(alias="parentNodeKey")
    parent_node_id: Optional['str'] = Field(alias="parentNodeId")
    invalid_content: Optional['bool'] = Field(alias="invalidContent")
    serialized_content: Optional['str'] = Field(alias="serializedContent")
    serialization_type: Optional['str'] = Field(alias="serializationType")
    draft_id: Optional['str'] = Field(alias="draftId")
    working_draft_id: Optional['str'] = Field(alias="workingDraftId")
    activated_draft_id: Optional['str'] = Field(alias="activatedDraftId")
    show_in_viewer_mode: Optional['bool'] = Field(alias="showInViewerMode")
    public_available: Optional['bool'] = Field(alias="publicAvailable")
    embeddable: Optional['bool'] = Field(alias="embeddable")
    root_node_id: Optional['str'] = Field(alias="rootNodeId")
    order: Optional['int'] = Field(alias="order")
    source: Optional['str'] = Field(alias="source")
    asset_metadata_transport: Optional['AssetMetadataTransport'] = Field(alias="assetMetadataTransport")
    space_id: Optional['str'] = Field(alias="spaceId")
    change_date: Optional['datetime'] = Field(alias="changeDate")
    created_by_id: Optional['str'] = Field(alias="createdById")
    creation_date: Optional['datetime'] = Field(alias="creationDate")
    created_by_name: Optional['str'] = Field(alias="createdByName")
    updated_by: Optional['str'] = Field(alias="updatedBy")
    asset: Optional['bool'] = Field(alias="asset")
    root: Optional['bool'] = Field(alias="root")
    object_id: Optional['str'] = Field(alias="objectId")
    root_with_key: Optional['str'] = Field(alias="rootWithKey")
    identifier: Optional['str'] = Field(alias="identifier")


class RelatedAsset(PyCelonisBaseModel):
    object_id: Optional['str'] = Field(alias="objectId")
    type_: Optional['str'] = Field(alias="type")
    relation_type: Optional['RelationType'] = Field(alias="relationType")
    cascade_type: Optional['CascadeType'] = Field(alias="cascadeType")


class SourceUsageMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")


class TargetUsageMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    type_: Optional['str'] = Field(alias="type")
    source_objects: Optional['List[Optional[SourceUsageMetadata]]'] = Field(alias="sourceObjects")


class VariableDefinition(PyCelonisBaseModel):
    key: Optional['str'] = Field(alias="key")
    type_: Optional['str'] = Field(alias="type")
    description: Optional['str'] = Field(alias="description")
    source: Optional['str'] = Field(alias="source")
    runtime: Optional['bool'] = Field(alias="runtime")
    metadata: Optional['JsonNode'] = Field(alias="metadata")


class ActionInput(PyCelonisBaseModel):
    name: Optional['str'] = Field(alias="name")
    attribute: Optional['str'] = Field(alias="attribute")


class ActionMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    skill_id: Optional['str'] = Field(alias="skillId")
    skill_key: Optional['str'] = Field(alias="skillKey")
    records: Optional['List[Optional[str]]'] = Field(alias="records")
    filters: Optional['List[Optional[str]]'] = Field(alias="filters")
    inputs: Optional['List[Optional[ActionInput]]'] = Field(alias="inputs")
    type_: Optional['MetadataType'] = Field(alias="type")


class ActivityMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    value: Optional['str'] = Field(alias="value")
    type_: Optional['MetadataType'] = Field(alias="type")


class AlertMetric(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    pql: Optional['str'] = Field(alias="pql")
    message: Optional['str'] = Field(alias="message")


class AnomalyKpiMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    kpi_id: Optional['str'] = Field(alias="kpiId")
    impact_calculation: Optional['str'] = Field(alias="impactCalculation")
    scope: Optional['ScopeType'] = Field(alias="scope")


class AnomalyMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    flag: Optional['str'] = Field(alias="flag")
    kpi_ids: Optional['List[Optional[str]]'] = Field(alias="kpiIds")
    kpis: Optional['List[Optional[AnomalyKpiMetadata]]'] = Field(alias="kpis")
    mom_change: Optional['str'] = Field(alias="momChange")
    knowledge_object_id: Optional['str'] = Field(alias="knowledgeObjectId")
    type_: Optional['MetadataType'] = Field(alias="type")


class AttributeMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    pql: Optional['str'] = Field(alias="pql")
    filter_ids: Optional['List[Optional[str]]'] = Field(alias="filterIds")
    column_type: Optional['str'] = Field(alias="columnType")
    unit: Optional['str'] = Field(alias="unit")
    format: Optional['str'] = Field(alias="format")
    type_: Optional['MetadataType'] = Field(alias="type")


class AugmentedAttributeMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    possible_values: Optional['List[Optional[str]]'] = Field(alias="possibleValues")
    default_value: Optional['str'] = Field(alias="defaultValue")
    column_type: Optional['str'] = Field(alias="columnType")
    pql: Optional['str'] = Field(alias="pql")
    unit: Optional['str'] = Field(alias="unit")
    format: Optional['str'] = Field(alias="format")
    housekeeping: Optional['bool'] = Field(alias="housekeeping")
    type_: Optional['MetadataType'] = Field(alias="type")


class BaseMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")


class BusinessRecordMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    augmented: Optional['bool'] = Field(alias="augmented")
    identifier: Optional['PqlBaseMetadata'] = Field(alias="identifier")
    pql: Optional['str'] = Field(alias="pql")
    filter_ids: Optional['List[Optional[str]]'] = Field(alias="filterIds")
    attributes: Optional['List[Optional[AttributeMetadata]]'] = Field(alias="attributes")
    new_attributes: Optional['List[Optional[NewAttributeMetadata]]'] = Field(alias="newAttributes")
    augmented_attributes: Optional['List[Optional[AugmentedAttributeMetadata]]'] = Field(alias="augmentedAttributes")
    flags: Optional['List[Optional[PqlBaseMetadata]]'] = Field(alias="flags")
    priorities: Optional['List[Optional[RecordPriorityMetadata]]'] = Field(alias="priorities")
    data_triggers: Optional['List[Optional[DataTriggerMetadata]]'] = Field(alias="dataTriggers")
    type_: Optional['MetadataType'] = Field(alias="type")


class DataTriggerMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    filter_ids: Optional['List[Optional[str]]'] = Field(alias="filterIds")
    type_: Optional['MetadataType'] = Field(alias="type")


class EventLogKpi(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    event_log_id: Optional['str'] = Field(alias="eventLogId")
    node_kpi_ids: Optional['List[Optional[str]]'] = Field(alias="nodeKpiIds")
    edge_kpi_ids: Optional['List[Optional[str]]'] = Field(alias="edgeKpiIds")
    node_kpis: Optional['List[Optional[KpiWithAlert]]'] = Field(alias="nodeKpis")
    edge_kpis: Optional['List[Optional[KpiWithAlert]]'] = Field(alias="edgeKpis")


class EventLogKpiView(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    icon: Optional['str'] = Field(alias="icon")
    event_log_kpis: Optional['List[Optional[EventLogKpi]]'] = Field(alias="eventLogKpis")
    transition_kpis: Optional['List[Optional[EventLogTransitionKpi]]'] = Field(alias="transitionKpis")


class EventLogMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    pql: Optional['str'] = Field(alias="pql")
    filter_ids: Optional['List[Optional[str]]'] = Field(alias="filterIds")
    type_: Optional['MetadataType'] = Field(alias="type")


class EventLogTransition(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    first_event_log_id: Optional['str'] = Field(alias="firstEventLogId")
    second_event_log_id: Optional['str'] = Field(alias="secondEventLogId")
    type_: Optional['TransitionType'] = Field(alias="type")


class EventLogTransitionKpi(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    transition_id: Optional['str'] = Field(alias="transitionId")
    kpi_id: Optional['str'] = Field(alias="kpiId")


class FilterMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    pql: Optional['str'] = Field(alias="pql")
    filter_ids: Optional['List[Optional[str]]'] = Field(alias="filterIds")
    global_: Optional['bool'] = Field(alias="global")
    type_: Optional['MetadataType'] = Field(alias="type")


class FinalLayerTransport(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    layer: Optional['LayerTransport'] = Field(alias="layer")
    yaml_object: Optional['str'] = Field(alias="yamlObject")


class KpiBenchmarking(PyCelonisBaseModel):
    value: Optional['str'] = Field(alias="value")
    action: Optional['KpiBenchmarkingAction'] = Field(alias="action")
    leading_bucket: Optional['PerformanceBucket'] = Field(alias="leadingBucket")
    exceeding_bucket: Optional['PerformanceBucket'] = Field(alias="exceedingBucket")
    achieving_bucket: Optional['PerformanceBucket'] = Field(alias="achievingBucket")
    lagging_bucket: Optional['PerformanceBucket'] = Field(alias="laggingBucket")


class KpiBenchmarkingAction(PyCelonisBaseModel):
    name: Optional['str'] = Field(alias="name")
    description: Optional['str'] = Field(alias="description")
    link: Optional['str'] = Field(alias="link")


class KpiMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    pql: Optional['str'] = Field(alias="pql")
    filter_ids: Optional['List[Optional[str]]'] = Field(alias="filterIds")
    unit: Optional['str'] = Field(alias="unit")
    format: Optional['str'] = Field(alias="format")
    breakdowns: Optional['List[Optional[BaseMetadata]]'] = Field(alias="breakdowns")
    aggregations: Optional['List[Optional[str]]'] = Field(alias="aggregations")
    parameters: Optional['List[Optional[ParameterMetadata]]'] = Field(alias="parameters")
    targets: Optional['List[Optional[TargetMetadata]]'] = Field(alias="targets")
    desired_direction: Optional['KpiDirection'] = Field(alias="desiredDirection")
    priority: Optional['bool'] = Field(alias="priority")
    benchmarking: Optional['KpiBenchmarking'] = Field(alias="benchmarking")
    type_: Optional['MetadataType'] = Field(alias="type")
    benchmarkable: Optional['bool'] = Field(alias="benchmarkable")


class KpiWithAlert(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    kpi_id: Optional['str'] = Field(alias="kpiId")
    icon: Optional['str'] = Field(alias="icon")
    alert_metrics: Optional['List[Optional[AlertMetric]]'] = Field(alias="alertMetrics")


class LayerBase(PyCelonisBaseModel):
    key: Optional['str'] = Field(alias="key")
    version: Optional['str'] = Field(alias="version")
    app_store_based: Optional['bool'] = Field(alias="appStoreBased")


class LayerMetadata(PyCelonisBaseModel):
    key: Optional['str'] = Field(alias="key")
    display_name: Optional['str'] = Field(alias="displayName")
    version: Optional['str'] = Field(alias="version")


class LayerTransport(PyCelonisBaseModel):
    kind: Optional['LayerKind'] = Field(alias="kind")
    metadata: Optional['LayerMetadata'] = Field(alias="metadata")
    base: Optional['LayerBase'] = Field(alias="base")
    data_model_id: Optional['str'] = Field(alias="dataModelId")
    records: Optional['List[Optional[BusinessRecordMetadata]]'] = Field(alias="records")
    kpis: Optional['List[Optional[KpiMetadata]]'] = Field(alias="kpis")
    filters: Optional['List[Optional[FilterMetadata]]'] = Field(alias="filters")
    variables: Optional['List[Optional[VariableMetadata]]'] = Field(alias="variables")
    activities: Optional['List[Optional[ActivityMetadata]]'] = Field(alias="activities")
    event_logs_metadata: Optional['NewEventLogMetadata'] = Field(alias="eventLogsMetadata")
    anomalies: Optional['List[Optional[AnomalyMetadata]]'] = Field(alias="anomalies")
    event_logs: Optional['List[Optional[EventLogMetadata]]'] = Field(alias="eventLogs")
    custom_objects: Optional['List[Optional[BaseMetadata]]'] = Field(alias="customObjects")
    id: Optional['str'] = Field(alias="id")
    tenant_id: Optional['str'] = Field(alias="tenantId")
    actions: Optional['List[Optional[ActionMetadata]]'] = Field(alias="actions")
    node_entity_id: Optional['str'] = Field(alias="nodeEntityId")


class NewAttributeMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    possible_values: Optional['List[Optional[str]]'] = Field(alias="possibleValues")
    default_value: Optional['str'] = Field(alias="defaultValue")
    column_type: Optional['str'] = Field(alias="columnType")
    unit: Optional['str'] = Field(alias="unit")
    format: Optional['str'] = Field(alias="format")
    type_: Optional['MetadataType'] = Field(alias="type")


class NewEventLogMetadata(PyCelonisBaseModel):
    event_logs: Optional['List[Optional[SingleEventLogMetadata]]'] = Field(alias="eventLogs")
    transitions: Optional['List[Optional[EventLogTransition]]'] = Field(alias="transitions")
    kpi_views: Optional['List[Optional[EventLogKpiView]]'] = Field(alias="kpiViews")


class ParameterMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    default_value: Optional['str'] = Field(alias="defaultValue")
    type_: Optional['ParameterType'] = Field(alias="type")


class PerformanceBucket(PyCelonisBaseModel):
    name: Optional['str'] = Field(alias="name")
    text_snippet: Optional['str'] = Field(alias="textSnippet")
    text_snippet_active: Optional['str'] = Field(alias="textSnippetActive")
    upper_value: Optional['str'] = Field(alias="upperValue")
    lower_value: Optional['str'] = Field(alias="lowerValue")


class PqlBaseMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    pql: Optional['str'] = Field(alias="pql")
    filter_ids: Optional['List[Optional[str]]'] = Field(alias="filterIds")


class RecordPriorityMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    pql: Optional['str'] = Field(alias="pql")
    filter_ids: Optional['List[Optional[str]]'] = Field(alias="filterIds")
    kpi: Optional['str'] = Field(alias="kpi")


class SingleEventLogMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    pql: Optional['str'] = Field(alias="pql")
    filter_ids: Optional['List[Optional[str]]'] = Field(alias="filterIds")
    record_id: Optional['str'] = Field(alias="recordId")
    default_event_log: Optional['bool'] = Field(alias="defaultEventLog")


class TargetMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    value: Optional['str'] = Field(alias="value")
    date_from: Optional['str'] = Field(alias="dateFrom")
    date_until: Optional['str'] = Field(alias="dateUntil")
    filters: Optional['List[Optional[str]]'] = Field(alias="filters")


class VariableMetadata(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    display_name: Optional['str'] = Field(alias="displayName")
    short_display_name: Optional['str'] = Field(alias="shortDisplayName")
    description: Optional['str'] = Field(alias="description")
    scope: Optional['ScopeType'] = Field(alias="scope")
    internal_note: Optional['str'] = Field(alias="internalNote")
    custom_attributes: Optional['JsonNode'] = Field(alias="customAttributes")
    auto_generated: Optional['bool'] = Field(alias="autoGenerated")
    value: Optional['str'] = Field(alias="value")
    type_: Optional['MetadataType'] = Field(alias="type")


class ComputeCallerInfo(PyCelonisBaseModel):
    object_id: Optional['str'] = Field(alias="objectId")
    object_type: Optional['ComputeCallerType'] = Field(alias="objectType")


class DataCommand(PyCelonisBaseModel):
    cube_id: Optional['str'] = Field(alias="cubeId")
    commands: Optional['List[Optional[DataQuery]]'] = Field(alias="commands")


class DataCommandBatchRequest(PyCelonisBaseModel):
    variables: Optional['List[Optional[Variable]]'] = Field(alias="variables")
    requests: Optional['List[Optional[DataCommandBatchTransport]]'] = Field(alias="requests")


class DataCommandBatchTransport(PyCelonisBaseModel):
    id: Optional['str'] = Field(alias="id")
    request: Optional['DataCommand'] = Field(alias="request")


class DataQuery(PyCelonisBaseModel):
    computation_id: Optional['int'] = Field(alias="computationId")
    queries: Optional['List[Optional[str]]'] = Field(alias="queries")
    is_transient: Optional['bool'] = Field(alias="isTransient")


class LayerComputeTransport(PyCelonisBaseModel):
    caller_info: Optional['ComputeCallerInfo'] = Field(alias="callerInfo")
    layer: Optional['LayerTransport'] = Field(alias="layer")
    request: Optional['QueryRequest'] = Field(alias="request")
    draft: Optional['bool'] = Field(alias="draft")


class QueryRequest(PyCelonisBaseModel):
    batch_request: Optional['DataCommandBatchRequest'] = Field(alias="batchRequest")
    filters: Optional['List[Optional[str]]'] = Field(alias="filters")


class Variable(PyCelonisBaseModel):
    name: Optional['str'] = Field(alias="name")
    type_: Optional['str'] = Field(alias="type")
    value: Optional['str'] = Field(alias="value")


class DataPermissionRule(PyCelonisBaseModel):
    values: Optional['List[Optional[str]]'] = Field(alias="values")
    column_id: Optional['str'] = Field(alias="columnId")
    table_id: Optional['str'] = Field(alias="tableId")


class Kpi(PyCelonisBaseModel):
    name: Optional['str'] = Field(alias="name")
    template: Optional['str'] = Field(alias="template")
    parameter_count: Optional['int'] = Field(alias="parameterCount")
    error: Optional['str'] = Field(alias="error")
    formula: Optional['str'] = Field(alias="formula")


class KpiInformation(PyCelonisBaseModel):
    kpis: Optional['Dict[str, Optional[Kpi]]'] = Field(alias="kpis")


class PostBatchQueryTransport(PyCelonisBaseModel):
    analysis_commands: Optional['List[Optional[DataCommandBatchTransport]]'] = Field(alias="analysisCommands")
    query_environment: Optional['QueryEnvironment'] = Field(alias="queryEnvironment")


class QueryEnvironment(PyCelonisBaseModel):
    accelerator_session_id: Optional['str'] = Field(alias="acceleratorSessionId")
    process_id: Optional['str'] = Field(alias="processId")
    user_id: Optional['str'] = Field(alias="userId")
    user_name: Optional['str'] = Field(alias="userName")
    load_script: Optional['str'] = Field(alias="loadScript")
    kpi_infos: Optional['KpiInformation'] = Field(alias="kpiInfos")
    data_permission_rules: Optional['List[Optional[DataPermissionRule]]'] = Field(alias="dataPermissionRules")
    data_permission_strategy: Optional['DataPermissionStrategy'] = Field(alias="dataPermissionStrategy")


ExceptionReference.update_forward_refs()
FrontendHandledBackendError.update_forward_refs()
FinalModelOptions.update_forward_refs()
YamlMetadata.update_forward_refs()
AssetMetadataTransport.update_forward_refs()
AssetUsage.update_forward_refs()
ContentNodeBaseTransport.update_forward_refs()
ContentNodeTransport.update_forward_refs()
RelatedAsset.update_forward_refs()
SourceUsageMetadata.update_forward_refs()
TargetUsageMetadata.update_forward_refs()
VariableDefinition.update_forward_refs()
ActionInput.update_forward_refs()
ActionMetadata.update_forward_refs()
ActivityMetadata.update_forward_refs()
AlertMetric.update_forward_refs()
AnomalyKpiMetadata.update_forward_refs()
AnomalyMetadata.update_forward_refs()
AttributeMetadata.update_forward_refs()
AugmentedAttributeMetadata.update_forward_refs()
BaseMetadata.update_forward_refs()
BusinessRecordMetadata.update_forward_refs()
DataTriggerMetadata.update_forward_refs()
EventLogKpi.update_forward_refs()
EventLogKpiView.update_forward_refs()
EventLogMetadata.update_forward_refs()
EventLogTransition.update_forward_refs()
EventLogTransitionKpi.update_forward_refs()
FilterMetadata.update_forward_refs()
FinalLayerTransport.update_forward_refs()
KpiBenchmarking.update_forward_refs()
KpiBenchmarkingAction.update_forward_refs()
KpiMetadata.update_forward_refs()
KpiWithAlert.update_forward_refs()
LayerBase.update_forward_refs()
LayerMetadata.update_forward_refs()
LayerTransport.update_forward_refs()
NewAttributeMetadata.update_forward_refs()
NewEventLogMetadata.update_forward_refs()
ParameterMetadata.update_forward_refs()
PerformanceBucket.update_forward_refs()
PqlBaseMetadata.update_forward_refs()
RecordPriorityMetadata.update_forward_refs()
SingleEventLogMetadata.update_forward_refs()
TargetMetadata.update_forward_refs()
VariableMetadata.update_forward_refs()
ComputeCallerInfo.update_forward_refs()
DataCommand.update_forward_refs()
DataCommandBatchRequest.update_forward_refs()
DataCommandBatchTransport.update_forward_refs()
DataQuery.update_forward_refs()
LayerComputeTransport.update_forward_refs()
QueryRequest.update_forward_refs()
Variable.update_forward_refs()
DataPermissionRule.update_forward_refs()
Kpi.update_forward_refs()
KpiInformation.update_forward_refs()
PostBatchQueryTransport.update_forward_refs()
QueryEnvironment.update_forward_refs()


class SemanticLayerService:
    @staticmethod
    def post_api_semantic_models(client: Client, request_body: YamlMetadata) -> ContentNodeTransport:
        logger.debug(
            f"Request: 'POST' -> '/semantic-layer/api/semantic-models'",
            extra={
                "request_type": "POST",
                "path": "/semantic-layer/api/semantic-models",
                "tracking_type": "API_REQUEST",
            },
        )

        return client.request(
            method="POST",
            url=f"/semantic-layer/api/semantic-models",
            request_body=request_body,
            parse_json=True,
            type_=ContentNodeTransport,
        )

    @staticmethod
    def post_api_layer_id_name_final(
        client: Client, id_name: str, request_body: FinalModelOptions
    ) -> FinalLayerTransport:
        logger.debug(
            f"Request: 'POST' -> '/semantic-layer/api/layer/{id_name}/final'",
            extra={
                "request_type": "POST",
                "path": "/semantic-layer/api/layer/{id_name}/final",
                "tracking_type": "API_REQUEST",
            },
        )

        return client.request(
            method="POST",
            url=f"/semantic-layer/api/layer/{id_name}/final",
            request_body=request_body,
            parse_json=True,
            type_=FinalLayerTransport,
        )

    @staticmethod
    def post_api_knowledge_model_resolve_query(
        client: Client, request_body: LayerComputeTransport
    ) -> PostBatchQueryTransport:
        logger.debug(
            f"Request: 'POST' -> '/semantic-layer/api/knowledge-model/resolve-query'",
            extra={
                "request_type": "POST",
                "path": "/semantic-layer/api/knowledge-model/resolve-query",
                "tracking_type": "API_REQUEST",
            },
        )

        return client.request(
            method="POST",
            url=f"/semantic-layer/api/knowledge-model/resolve-query",
            request_body=request_body,
            parse_json=True,
            type_=PostBatchQueryTransport,
        )

