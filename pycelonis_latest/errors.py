"""Module for PyCelonis specific error classes.

This module contains all PyCelonis specific error classes used throughout the package.

Typical usage example:

    ```python
    raise PyCelonisError("This is an error in PyCelonis")
    raise PyCelonisLoadInProgressError()
    ```
"""
import logging
import typing

from pycelonis_core.utils.errors import PyCelonisError

if typing.TYPE_CHECKING:
    from pycelonis.service.integration.service import DataModelLoadStatus, ExecutionStatus, ExportStatus, JobStatus


logger = logging.getLogger(__name__)


class PyCelonisLoadInProgressError(PyCelonisError):
    """Raised when data model reload is already in progress."""

    def __init__(self) -> None:
        """Instantiates PyCelonisLoadInProgressError with load in progress message."""
        super().__init__("There is already a data model reload in progress.")


class PyCelonisExecutionInProgressError(PyCelonisError):
    """Raised when job execution is already in progress."""

    def __init__(self) -> None:
        """Instantiates PyCelonisExecutionInProgressError with execution in progress message."""
        super().__init__("There is already a job execution in progress.")


class PyCelonisDataPushJobNotNew(PyCelonisError):
    """Raised when data push job execution is already in progress."""

    def __init__(self) -> None:
        """Instantiates PyCelonisDataPushJobNotNew with data push job not new message."""
        super().__init__("Data push job has already been executed. Create new data push job for new executions.")


class PyCelonisReloadFailedError(PyCelonisError):
    """Raised when data model reload failed."""

    def __init__(self, load_status: typing.Optional["DataModelLoadStatus"], message: typing.Optional[str]):
        """Instantiates PyCelonisReloadFailedError with error message based on current compute load status."""
        super().__init__(message=f"{load_status.value if load_status else ''} {message}".strip())


class PyCelonisExecutionFailedError(PyCelonisError):
    """Raised when job execution failed."""

    def __init__(self, error_message: "str"):
        """Instantiates PyCelonisExecutionFailedError with error message based on current execution status."""
        super().__init__(message=error_message)


class PyCelonisDataPushExecutionFailedError(PyCelonisError):
    """Raised when data push job execution failed."""

    def __init__(self, status: typing.Optional["JobStatus"], logs: typing.Optional[typing.List[typing.Optional[str]]]):
        """Instantiates PyCelonisDataPushExecutionFailedError with execution failed error message."""
        message = "Data push job execution failed."
        if status:
            message += f" Status: {status.value}."
        if logs:
            error_logs = "\n".join(str(log) for log in logs)
            message += f"\nLogs:\n{error_logs}"

        super().__init__(message=message)


class PyCelonisNotSupportedError(PyCelonisError):
    """Raised when method is not supported."""


class PyCelonisTableAlreadyExistsError(PyCelonisError):
    """Raised when table already exists in data pool."""

    def __init__(self, table_name: str):
        """Instantiates PyCelonisTableAlreadyExistsError."""
        super().__init__(f"Table '{table_name}' already exists.")


class PyCelonisDataExportFailedError(PyCelonisError):
    """Raised when data export failed."""

    def __init__(self, export_status: typing.Optional["ExportStatus"], message: typing.Optional[str]):
        """Instantiates PyCelonisDataExportFailed with error message based on current data export status."""
        super().__init__(message=f"{export_status.value if export_status else ''} " f"{message}".strip())


class PyCelonisDataExportRunningError(PyCelonisError):
    """Raised when data export is still in progress."""

    def __init__(self) -> None:
        """Instantiates PyCelonisDataExportRunningError with data export in progress message."""
        super().__init__(message="Data export still in progress.")


class PyCelonisQueryResolutionError(PyCelonisError):
    """Raised when analysis query resolution failed."""

    def __init__(self, message: str) -> None:
        """Instantiates PyCelonisAnalysisQueryResolutionError with query resolution error message."""
        super().__init__(message=f"Query resolution failed: {message}")


class PyCelonisDataExportNotEnabledError(PyCelonisError):
    """Raised when data export not enabled."""

    def __init__(self) -> None:
        """Instantiates PyCelonisDataExportNotEnabledError with data export not enabled error message."""
        super().__init__(message="Data Export not enabled. Please contact Celonis customer support.")

